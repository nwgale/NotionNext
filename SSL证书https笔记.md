SSL证书配置与维护笔记

1. 当前证书状态概览
•
​域名​：tianfei.chat(主域名), www.tianfei.chat(子域名)
•
​颁发机构​：Encryption Everywhere DV TLS CA - G2 (DigiCert)
•
​证书类型​：DV (域名验证型)
•
​生效时间​：2025-08-17
•
​到期时间​：2025-11-14
•
​剩余有效期​：67天 (截至2025-09-08)
•
​部署状态​：✅ 已部署
•
​强制HTTPS​：❌ 未开启 (需立即启用)
2. 关键配置操作指南

​🔐 强制HTTPS配置​
nginx
复制
# 必要性：防止中间人攻击，提升SEO排名，避免内容重复抓取
# 操作路径：SSL设置 → 开启【强制HTTPS】开关 → 保存
​⏰ 到期提醒设置​
bash
复制
# 推荐配置：
# - 首次提醒：到期前30天
# - 二次提醒：到期前7天 (保险措施)
# 操作路径：SSL设置 → 开启【到期提醒】→ 点击配置 → 设置时间 → 保存
3. 证书文件管理规范
文件类型
标准路径
权限要求
内容特征
私钥文件
/www/ssl/tianfei.chat.key
600 (rw-------)
以-----BEGIN PRIVATE KEY-----开头
证书文件
/www/ssl/tianfei.chat.pem
644 (rw-r--r--)
包含证书链，以-----BEGIN CERTIFICATE-----开头
4. 证书续期操作流程
复制
flowchart TD
    A[证书到期前30天] --> B[收到提醒通知]
    B --> C{选择续期方式}
    C --> D[方案A: 重新申请]
    C --> E[方案B: 更换证书]
    
    subgraph D [重新申请流程]
        D1[登录证书管理界面] --> D2[选择证书类型]
        D2 --> D3[验证域名所有权]
        D3 --> D4[下载新证书]
        D4 --> D5[替换旧证书文件]
    end
    
    subgraph E [更换证书流程]
        E1[获取新证书文件] --> E2[备份旧证书]
        E2 --> E3[上传新证书]
        E3 --> E4[更新Nginx配置]
    end
    
    D5 --> F[验证HTTPS访问]
    E4 --> F
    F --> G[✅ 续期完成]
5. 故障排查清单
•
​HTTPS无法访问​：
✅ 检查安全组443端口开放状态
✅ 验证证书文件路径是否正确
✅ 确认证书链完整性 (PEM文件需包含中间证书)
•
​浏览器警告​：
✅ 检查系统时间是否准确
✅ 确认证书与域名匹配情况
✅ 验证证书链完整性
6. 下次过期应对方案

​方案A：原证书重新申请​（推荐）
1.
到期前30天登录证书管理界面
2.
点击【重新申请】按钮
3.
通过DNS或文件方式验证域名所有权
4.
下载新证书并替换旧文件
5.
重启Nginx服务：sudo systemctl reload nginx
​方案B：更换新证书​
1.
从其他CA机构获取新证书
2.
备份旧证书文件：cp /www/ssl/tianfei.chat.key{,.bak}
3.
上传新证书到指定路径
4.
更新Nginx配置指向新证书
5.
执行配置测试：sudo nginx -t
6.
重载服务：sudo systemctl reload nginx
7. 最佳实践建议
1.
​自动化部署​：考虑使用Certbot等工具实现自动续期
2.
​监控预警​：配置多通道提醒（邮件+短信）
3.
​备份策略​：每次更新前备份证书文件：
bash
复制
# 创建备份目录
sudo mkdir -p /www/ssl/backup/$(date +%Y%m%d)
# 备份证书文件
sudo cp /www/ssl/tianfei.chat.* /www/ssl/backup/$(date +%Y%m%d)/
4.
​文档维护​：记录每次证书更新时间和操作人员
📌 注：本笔记基于当前证书状态（有效期至2025-11-14）制定，下次续期操作应在2025-10-15前启动。